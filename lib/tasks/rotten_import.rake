desc "Import Rotten Tomatoes"
task :rotten_import => :environment do
  require 'net/http'
  require 'json'
  units = ["Ben Hur", "Humorous Phases of Funny Faces", "A Trip to the Moon", "The Great Train Robbery", "The Impossible Voyage", "The Story of the Kelly Gang", "A Corner in Wheat", "President McKinley Inauguration Footage", "Star Theatre", "Princess Nicotine", "Ben Hur", "The Cisco Kid", "Jeanne d'Arc", "Alice in Wonderland", "Romeo and Juliet", "The Fairylogue and Radio-Plays", "The Reprieve: An Episode in the Life of Abraham Lincoln", "A Trap for Santa Claus", "The Golden Louis", "The Death Disc: A Story of the Cromwellian Period", "Vie et Passion du Christ", "His Wife's Child", "The Cowboy Millionaire", "A Midsummer Night's Dream", "The Man with the Rubber Head", "The Sealed Room", "Dr. Jekyll and Mr. Hyde", "Resurrection", "Am Sklavenmarkt", "Barbe-bleue", "The Taming of the Shrew", "Salaviinanpolttajat", "20,000 Leagues Under the Sea", "Lady Helen's Escapade", "L'Auberge du Bon Repos", "The Infernal Boiling Pot", "As Seen Through a Telescope", "Grandma's Reading Glass", "Sherlock Holmes Baffled", "The Two Blind Men", "Life of an American Fireman", "Le Voyage de Gulliver à Lilliput et chez les géants", "Boxing in Barrels", "The Life of Bakuvians and Their Movement Along the Velikokniaz Avenue", "Transportation of Coal", "An Affair of Honor", "Seaside Walk", "Work at Oil Derricks", "Oil Extraction", "Snow White", "Bakuvians Walk in the City Park", "Arrival of Tongkin Train", "Another Job for the Undertaker", "Band and Battalion of the U.S. Indian School", "Clowns Spinning Hats", "Feeding Sea Lions", "The Artist's Dilemma", "Capture of Boer Battery by British", "Tom Sawyer", "Types of Bakuvian Bazaars", "The Enchanted Drawing", "A Christmas Carol", "El hotel eléctrico", "Searching Ruins on Broadway, Galveston, for Dead Bodies", "Satán se divierte", "Antony and Cleopatra", "Dream of a Rarebit Fiend", "The Country Doctor", "The Red Man's View", "Ben's Kid", "The Curtain Pole", "After Many Years", "The Lonely Villa", "At the Altar", "Rescued from an Eagle's Nest", "Money Mad", "Balked at the Altar", "Mrs. Jones' Birthday", "The Eclipse: Courtship of the Sun and Moon", "The Hessian Renegades", "The Adventures of Dollie", "Making It Pleasant for Him", "The Assassination of the Duke of Guise", "Those Awful Hats", "Bill Sharkey's Last Game", "Mr. Flip", "We Must Do Our Best", "A Drunkard's Reformation", "Esmeralda", "Macbeth", "Fools of Fate", "Hamlet", "Fire!", "Lyrical Nitrate & Forbidden Quest", "Macbeth", "Macbeth", "Otello", "Runaway Match", "Fairyland: A Kingdom of Fairies", "In Little Italy", "Choosing a Husband", "The Day After", "To Save Her Soul", "Løvejagten", "Capital Execution", "The Bushranger", "Bushranging in Northern Queensland", "Robbery Under Arms", "The Consequences of Feminism", "The Thieving Hand", "Tunneling the Channel", "Above the Limit", "Stenka Razin", "Song About the Merchant Kalashnikov", "Wilbur Wright und seine Flugmaschine", "Romeo and Juliet", "The Misadventure of a French Gentleman Without Pants at the Zandvoort Beach", "Een Jongmensch...", "Les Misérables", "The Battle of Dingjunshan", "First Prize for the Cello", "The Call of the Wild", "What Happened on Twenty-third Street, New York City", "L'Enfant prodigue", "Grandma Threading her Needle", "The Sick Kitten", "The House That Jack Built", "Mary Jane's Mishap", "Hamlet", "The Night Before Christmas", "Scrooge, or, Marley's Ghost", "The Christian Martyrs", "In the Sultan's Power", "Damon and Pythias", "Sure Cure for Indigestion", "Cakewalk at the Nouveau Cirque", "San Francisco Earthquake and Fire, April 18, 1906", "Spaceborne", "Fantasmagorie", "Oliver Twist", "Kicking Sand in Your Face", "Adventures of Sherlock Holmes; or, Held for Ransom", "Gaumont Treasures: The Films of Leonce Perret", "The Scottish Covenanters", "The Magic of Méliès", "Romance of a Jewess", "Baby's Toilet", "Explosion of a Motor Car", "The Whip", "The Beggar's Deceit", "The Black Viper", "The Fight for Freedom", "The Tavern Keeper's Daughter", "The Red Man and the Child", "Concorso di bellezza fra bambini a Torino", "Roi des Dollars", "A Trip Down Market Street", "La Revolución de Mayo", "Move On", "The Magician", "The Martyred Presidents", "The Old Maid's Valentine", "Tartans of Scottish Clans", "Woman Draped in Patterned Handkerchiefs", "Spiders on a Web", "Choosing the Wallpaper", "Kinemacolor Puzzle", "Natural Colour Portraiture", "The Baby and the Ape", "Dorothy's Dream", "John Bull's Hearth", "The Free Trade Bench", "Life of a London Bobby", "Pa's Comment on the Morning News", "The Monk in the Monastery Wine Cellar", "Hilarity on Board Ship", "Pantomime Girls Having a Lark", "The Amazons' March and Evolutions", "Mother Goose Nursery Rhymes", "An Episode in the Life of a Lodger", "At Last! That Awful Tooth", "His First Cigar, Probably His Last", "That Awful Cigar", "The Monk in the Studio", "The Monk's Macaroni Feast", "The Monk's Ruse for Lunch", "Coronation of Their Majesties King Edward VII and Queen Alexandria", "Tambourine Dancing Quartette", "The March of the Amazons", "Tommy and the Mouse in the Art School", "Topsy-Turvy Dance by Three Quaker Maidens", "The Donkey and the Serpentine Dance", "The Irishman and the Button", "Tommy Atkins and His Harriet on a Bank Holiday", "Oh That Collar Button!", "The Cakewalk", "The Absent Minded Clerk, Fly Paper and Silk Hat", "The Two Old Sports at the Music Hall", "Too Much of a Good Thing", "In the Green Room", "The Adrian Troupe of Cyclists", "A Good Story", "Photograph from an Area Window", "The Kitten Nursery", "The Last Glass of the Two Old Sports", "The Little Doctor and the Sick Kitten", "The Bill Poster's Revenge", "The Monocle: Me and Joe Chamberlain", "Whiskey Versus Bullets", "The Little Doctors", "The Village Choir", "Where Did You Get It?", "Two Jolly Old Fellows", "A Bad Cigar", "Scandal Over the Teacups", "Snapshotting an Audience", "The Dull Razor", "The Two Old Sports' Game of Nap", "The Two Old Sports' Political Discussion", "A Quick Shave and Brush Up", "Let Me Dream Again", "A Jolly Old Couple", "An Incident on Brighton Pier", "The Conjurer", "The Two Old Sports", "Two Grinning Yokels", "Grandmother's Wolf", "Letty Limelight in Her Lair", "The Haunted Curiosity Shop", "The Big Swallow", "The Little Match Seller", "Attack on a China Mission", "Living Wigan", "An Interesting Story", "Restitution inattendue", "Flying the Foam and Some Fancy Diving", "Is Spiritualism a Fraud?", "Our New Errand Boy", "Morecambe Church Lads' Brigade at Drill", "The Coronation of Edward VII", "An Over-Incubated Baby", "The Red Spectre", "The Bandit's Waterloo", "The Magic Sword", "The Unfortunate Policeman", "The Countryman and the Cinematograph", "Undressing Extraordinary", "To Demonstrate How Spiders Fly", "Artistic Creation", "The Diligent Batman", "Le mariage forcé", "Je voudrais un enfant", "Entrevista de los presidentes Díaz-Taft", "Delhi grande ville de lInde supérieure", "The Clockwork Heart", "The Mechanical Man", "Le Pendu", "Folie de Pierrot", "The Mysterious Armor", "Zeitspiegel: Zwölf Minuten Ufa", "Zeitspiegel Nr. 3246", "Zeitspiegel: Zwölf Minuten bei der jüngsten dt.Filmprod.", "Trekking to Utopia", "Functional Disturbances In Organic Hemiplegia", "Meissner Porzellan", "Der Bettelstudent", "Funiculi-Funicula", "Army Life; or, How Soldiers Are Made: Mounted Infantry", "Mutterliebe", "For the Term of His Natural Life", "Eureka Stockade", "How It Feels to Be Run Over", "King Edward's Visit to Ireland", "De Greep", "Jack and the Beanstalk", "Fiskerlivets farer", "A Curious Dream", "Mark Twain at Stormfield, 1909", "Hiawatha", "The Misfortunes of an Explorer", "The Cook's Revenge", "The Devil in a Convent", "Addition and Subtraction", "L'homme orchestre", "Deceived Slumming Party", "The '?' Motorist", "Le rêve du radjah ou La forêt enchantée", "The Airship Destroyer", "The Monster", "The Death of Poor Joe", "The Moonstone", "Terrible Teddy, the Grizzly King", "The Tramp and the Crap Game", "£100 Reward", "Nursing a Viper", "The Automobile Thieves", "Marie Antoinette", "John Philip Sousa", "The Judgment of Solomon", "Sousa and His Band", "Ned Kelly and His Gang", "Spartacus", "Histoire d'un crime", "Parsifal", "Day at the Circus", "Daniel Boone", "Waiting at the Church", "The Miller's Daughter", "Electrocuting an Elephant", "Faust and Marguerite", "Traces Of Cinema", "Von Lothringen Und Griechenland", "Nick Carter, le roi des détectives - Épisode 1: Guêt-apens", "Kathleen Mavourneen", "Custody of the Child", "Train Wreckers", "A Day's Pleasure", "A Dog's Life", "A Florida Enchantment", "All Night", "Assunta Spina", "Behind the Screen", "Broken Blossoms", "Bucking Broadway", "By the Sea", "Cabiria", "Cleopatra", "Cruel, Cruel Love", "Different from the Others", "Dough and Dynamite", "Easy Street", "Fatty and Mabel Adrift", "Frankenstein", "From the Manger to the Cross", "Gertie the Dinosaur", "Hearts of the World", "His Majesty, the Scarecrow of Oz", "His New Profession", "In Night and Ice", "Intolerance", "Kid Auto Races at Venice", "L'Inferno", "One A.M.", "Out West", "Pool Sharks", "Salomé", "Saved from the Titanic", "Tarzan of the Apes", "The Adventurer", "The Birth of a Nation", "The Blue Bird", "The Blue Bird", "The Butcher Boy", "The Champion", "The Count", "The Cure", "The Exploits of Elaine", "The Fireman", "The First Men in the Moon", "The Floorwalker", "The Immigrant", "The Italian", "Frivolous Wives", "The Miracle Man", "The Musketeers of Pig Alley", "The Pawnshop", "Poor Little Rich Girl", "The Queen of Spades", "The Rink", "The Squaw Man", "The Tramp", "The Vagabond", "The Wings", "The Wonderful Wizard of Oz", "Tillie's Punctured Romance", "When the Clouds Roll By", "Where Are My Children?", "The Cheat", "Civilization", "Fatty's Tintype Tangle", "Hell's Hinges", "In the Land of the Head Hunters", "The Land Beyond the Sunset", "Regeneration", "Thunderbolt", "Wild and Woolly", "Deliverance", "The Battle of the Somme", "Out of the Inkwell", "The Boer War", "Making a Living", "Atlantis", "Geronimo's Last Raid", "Twenty Minutes of Love", "The Gulf Between", "Between Showers", "Judex", "Les Vampires", "The New Janitor", "Male and Female", "Raja Harishchandra", "The End of the World", "A Night in the Show", "A Woman", "A Jitney Elopement", "The Bond", "Police", "Shoulder Arms", "Sunnyside", "The Fable of Elvira and Farina and the Meal Ticket", "Burlesque on Carmen", "In the Park", "The Bank", "Triple Trouble", "Work", "Himmelskibet", "A Lad from Old Ireland", "What Happened to Mary?", "The Adventures of Kathlyn", "A Tale of Two Cities", "Bolshevism on Trial", "Snow White", "The Masquerader", "A Night Out", "The Sentimental Bloke", "The Deserter", "The Knockout", "A Christmas Carol", "Dalagang Bukid", "The Little Princess", "Anne of Green Gables", "Rebecca of Sunnybrook Farm", "In Old California", "The Passing of the Oklahoma Outlaws", "With Our King and Queen Through India", "Fight for the Dardanelles", "A Fool There Was", "Judith of Bethulia", "The Mirror", "The Forbidden City", "Divorce and the Daughter", "An Aerial Joy Ride", "A Primitive Man's Career to Civilization", "Roosevelt in Africa", "Das Mirakel", "A Daughter of the Gods", "The Lost Battalion", "The Delicious Little Devil", "The Birth of a Race", "The Spoilers", "20,000 Leagues Under the Sea", "Imokawa Mukuzo Genkanban no Maki", "The Magic Cloak of Oz", "The New York Hat", "Somewhere in Georgia", "Ask Father", "Recreation", "Abraham Lincoln's Clemency", "When Lincoln Was President", "When Lincoln Paid", "The Sleeping Sentinel", "Ravished Armenia", "Inspiration", "The Triumph of the Weak", "The Purple Dress", "Lights of New York", "The Gray Nun of Belgium", "Aerial Anarchists", "Satan Triumphant", "Captain Alvarez", "The Street Singer", "The County Fair", "The Young Millionaire", "The Tell-Tale Message", "A Battle of Wits", "All for a Girl", "A Business Buccaneer", "A Desperate Chance", "The Cub Reporter's Temptation", "The Game Warden", "The Fire Coward", "The Face at the Window", "The Pursuit of the Smugglers", "The Scimitar of the Prophet", "Unto the Third Generation", "The Green-Eyed Devil", "Home, Sweet Home", "The Girl in the Shack", "The Lover's Gift", "The Rose Bush of Memories", "His Father's Rifle", "To Be Called For", "The Livid Flame", "Rosemary, That's for Remembrance", "The Amateur Detective", "The Pasha's Daughter", "Baseball and Bloomers", "For Her Sake", "Cally's Comet", "The Railroad Builder"]
  units.each do |unit|
    name = URI.encode(unit)
    url = URI.parse("http://api.rottentomatoes.com/api/public/v1.0/movies.json?apikey=p4a9amhrxdchfyajehnnx3k2&q=#{name}&page_limit=1")
    req = Net::HTTP::Get.new(url.to_s)
    res = Net::HTTP.start(url.host, url.port) {|http|http.request(req)}
    j = JSON.parse(res.body)
    begin
      j["movies"].each do |e|
        id = e["id"]
        title = e["title"]
        year = e["year"]
        mpaa_rating = e["mpaa_rating"]
        runtime = e["runtime"]
        critics_consensus = e["critics_consensus"]
        release_theater = e["release_dates"]["theater"].to_date
        release_dvd = e["release_dates"]["dvd"].to_date
        critics_rating = e["ratings"]["critics_rating"]
        critics_score = e["ratings"]["critics_score"]
        audience_rating = e["ratings"]["audience_rating"]
        audience_score = e["ratings"]["audience_score"]
        synopsis = e["synopsis"]
        poster_url = e["posters"]["original"]
        imdb_id = e["alternate_ids"]["imdb"]
        rt_url = e["links"]["alternate"]
        cast_url = e["links"]["cast"]
        review_url = e["links"]["reviews"]
        similar_url = e["links"]["similar"]

        movie = Movie.where(rt_id: id).first_or_create(rt_id: id,title: title,year: year,mpaa_rating: mpaa_rating,runtime: runtime,release_theater: release_theater,release_dvd: release_dvd,critics_consensus: critics_consensus,critics_rating: critics_rating,critics_score: critics_score,audience_rating: audience_rating,audience_score: audience_score,synopsis: synopsis,poster_url: poster_url,imdb: imdb_id,rt_url: rt_url,cast_url: cast_url,review_url: review_url,similar_url: similar_url)

        d["abridged_cast"].each do |act|
          artist = Artist.where(name: act["name"]).first_or_create(name: act["name"], rt_artist_id: act["id"])
          artist_movie = ArtistMovie.where(artist_id: artist.id, movie_id: movie.id).first_or_create(artist_id: artist.id, movie_id: movie.id)
          act["characters"].each do |c|
            character = Character.where(artist_id: artist.id, movie_id: movie.id, name: c).first_or_create(artist_id: artist.id, movie_id: movie.id, name: c)
          end
        end
      end
    rescue

    end
  end
end